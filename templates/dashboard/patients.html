{% extends "dashboard/base_dashboard.html" %}

{% block title %}Patients{% endblock %}
{% block page_class %}patients-page{% endblock %}

{% block content %}
  

  <!-- Search Bar -->
  <section class="patients-search">
    <form method="get" class="patients-search-form" action="{% url 'patients' %}">
      <div class="patients-search-inputs">
        <input
          type="text"
          name="q"
          placeholder="Search patients..."
          value="{{ query }}"
          class="patients-search-field"
          autocomplete="off"
        />
        <button type="submit" class="patients-search-btn">Search</button>
      </div>
    </form>
  </section>

  <!-- Patients Table -->
  <section class="patients-list-section">
    <div class="section-header">
  {% if role == "doctor" %}
    <h3><i class="fa-solid fa-users"></i> Patients</h3>
    <a href="#" class="btn-view-all">Add New</a>
  {% elif role == "patient" %}
    <h3><i class="fa-solid fa-user"></i> Your Patient Record</h3>
  {% endif %}
</div>


    <div class="table-wrapper patients-table-wrapper">
      <table class="patients-list-table">
        <thead>
  <tr>
    {% if role == "doctor" %}
      <th>ID</th>
      <th>Name</th>
      <th>Phone</th>
      <th>Department</th>
      <th>Age</th>
      <th>Gender</th>
      <th>Actions</th>
    {% elif role == "patient" %}
      <th>ID</th>
      <th>Name</th>
      <th>Department</th>
      <th>Doctor</th>
      <th>Date</th>
    {% endif %}
  </tr>
</thead>
<tbody>
  {% for p in patients_page %}
    {% if role == "doctor" %}
      <tr>
        <td>{{ p.id }}</td>
        <td class="patient-name">{{ p.name }}</td>
        <td>{{ p.phone }}</td>
        <td>{{ p.department }}</td>
        <td>{{ p.age }}</td>
        <td>{{ p.gender }}</td>
        <td>
          <a href="" class="btn-action view">View</a>
          <a href="" class="btn-action update">Edit</a>
          <a href="" class="btn-action delete">Delete</a>
        </td>
      </tr>
    {% elif role == "patient" %}
      <tr>
        <td>{{ p.id }}</td>
        <td class="patient-name">{{ p.name }}</td>
        <td>{{ p.department }}</td>
        <td>
          {% with appt=p.appointments.first %}
            {% if appt and appt.doctor %}Dr. {{ appt.doctor.name }}{% else %}N/A{% endif %}
          {% endwith %}
        </td>
        <td>
          {% with appt=p.appointments.first %}
            {% if appt %}{{ appt.date|date:"Y-m-d H:i" }}{% else %}N/A{% endif %}
          {% endwith %}
        </td>
      </tr>
    {% endif %}
  {% empty %}
    <tr><td colspan="7">No patients found.</td></tr>
  {% endfor %}
</tbody>

      </table>
    </div>

    <!-- Pagination -->
    <div class="patients-pagination">
      <nav aria-label="Page navigation">
        <ul class="pagination-list">
          {% if patients_page.has_previous %}
            <li>
              <a href="?page={{ patients_page.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                &laquo; Prev
              </a>
            </li>
          {% else %}
            <li class="disabled">&laquo; Prev</li>
          {% endif %}

          {% for num in patients_page.paginator.page_range %}
            {% if num == patients_page.number %}
              <li class="active-page">{{ num }}</li>
            {% else %}
              <li>
                <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">{{ num }}</a>
              </li>
            {% endif %}
          {% endfor %}

          {% if patients_page.has_next %}
            <li>
              <a href="?page={{ patients_page.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                Next &raquo;
              </a>
            </li>
          {% else %}
            <li class="disabled">Next &raquo;</li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </section>
{% endblock %}
