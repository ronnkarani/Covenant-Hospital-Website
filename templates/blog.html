{% extends "base.html" %}
{% load static %}

{% block title %}Blog - Covenant Hospital{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero hero-small">
  <div class="hero-bg" style="background-image:url('{% static "images/contact-hero.jpg" %}');"></div>
  <div class="hero-overlay">
    <h1>Our Blog</h1>
    <a href="{% url 'contact' %}" class="btn appointment-btn">Book Appointment</a>
  </div>
</section>

<!-- Search + Categories -->
<section class="blog-search">
  <div class="search-container">
    <form method="get">
      <input type="text" name="q" placeholder="Search blogs..." value="{{ request.GET.q }}">
      <select name="category">
        <option value="">All Categories</option>
        {% for category in categories %}
          <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn">Search</button>
    </form>
  </div>
</section>

<!-- Blog Layout -->
<section class="blog-layout">
  <div class="blog-main">
    {% for blog in blogs %}
    <div class="blog-card">
      <img src="{{ blog.image.url }}" alt="{{ blog.title }}">
      <div class="blog-content">
        <h3>{{ blog.title }}</h3>
        <div class="blog-meta">
          <span><i class="fas fa-user"></i> {{ blog.author }}</span>
          <span><i class="fas fa-calendar"></i> {{ blog.date }}</span>
          <span><i class="fas fa-heart"></i> {{ blog.likes }}</span>
          <span><i class="fas fa-comments"></i> {{ blog.comments.count }}</span>
        </div>
        <p>{{ blog.content|truncatewords:20 }}</p>
        <a href="{% url 'blog_detail' blog.pk %}" class="btn readmore">Read More</a>
      </div>
    </div>
    {% empty %}
    <p>No blog posts found.</p>
    {% endfor %}
  </div>

  <!-- Sidebar -->
  <aside class="blog-sidebar">
    <div class="sidebar-box">
      <h3>Recent Posts</h3>
      <ul class="sidebar-posts">
        {% for post in recent_posts %}
        <li>
          <img src="{{ post.image.url }}" alt="">
          <a href="{% url 'blog_detail' post.pk %}">{{ post.title }}</a>
        </li>
        {% endfor %}
      </ul>
    </div>
  </aside>
</section>

<!-- Pagination -->
<div class="pagination">
  {% if blogs.has_previous %}
    <a href="?page={{ blogs.previous_page_number }}">&laquo; Prev</a>
  {% endif %}

  {% for num in blogs.paginator.page_range %}
    {% if blogs.number == num %}
      <a class="active">{{ num }}</a>
    {% else %}
      <a href="?page={{ num }}">{{ num }}</a>
    {% endif %}
  {% endfor %}

  {% if blogs.has_next %}
    <a href="?page={{ blogs.next_page_number }}">Next &raquo;</a>
  {% endif %}
</div>

<!-- Accreditation Section -->
{% include "includes/partners.html" %}
{% endblock %}

